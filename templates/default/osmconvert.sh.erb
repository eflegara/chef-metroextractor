<% require 'json' -%>
<% json = File.read("#{node[:metroextractor][:setup][:scriptsdir]}/cities.json") -%>
<% data = JSON.parse(json) -%>
<% data['regions'].each do |_, v| -%>
  <% v['cities'].each do |city, val| -%>
osmconvert <%= node[:metroextractor][:setup][:basedir] %>/planet.o5m --out-pbf -b=<%= val['bbox']['left'] %>,<%= val['bbox']['bottom'] %>,<%= val['bbox']['right'] %>,<%= val['bbox']['top'] %> -o=ex/<%= city %>.osm.pbf ><%= node[:metroextractor][:setup][:basedir] %>/logs/osmconvert_<%= city %>.log 2>&1
  <% end %>
<% end %>
